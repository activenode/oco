{"version":3,"sources":["index.js"],"names":["window","CustomEvent","event","params","bubbles","cancelable","detail","undefined","evt","document","createEvent","initCustomEvent","prototype","Event","_OCO_INSTALL","_forEach","list","loopFunc","forEach","call","_loopObject","obj","Object","keys","key","_map","map","_extend","srcObj","arguments","excludeKeys","i","length","value","indexOf","NODE_TYPE_TEXT","OCO_ATTR","OCO_ATTR_NOT_SELECTOR","NODE_UPGRADED_PROTO_KEY","DEFAULT_EVENT_NAMESPACE","_installer","_document","_componentsDefined","_PF_componentsLibrary","_isPolyfillRequired","_isComponentDefined","elementName","_containsUnitializedCustomElements","domElement","querySelectorAll","_","join","_PF_setupHtmlObserver","observerCallback","MutationObserver","mutations","mutation","addedNodes","removedNodes","_PF_recursiveTreeUpgrade","observe","attributes","childList","characterData","subtree","_PF_getUpgradeableNodes","Array","isArray","componentsSelect","n","_PF_upgradeNode","tagName","toLowerCase","upgradePrototype","setPrototypeOf","createdCallback","attachedCallback","console","error","nodeType","childNodes","childDomElement","readyState","addEventListener","defineElement","getEventAndNamespace","eventName","splittedEventString","split","namespaceString","slice","trim","getElementPrototypeExtensions","__eventListeners","on","listener","eventAndNs","eventKey","eventNs","eventListenersRef","Map","has","set","get","push","off","listenerToRemove","_this","deleteListeners","evtNamespace","listenersArray","newListenersArray","listenerFromArray","removeEventListener","delete","log","getHtmlElementProto","create","HTMLElement","methodsObj","_attachedCallback","setAttribute","detachedCallback","_detachedCallback","attachedDetachedMethods","classDefinition","eval","skipMethods","customElements","define","elementPrototype","registerElement","upgradeableNodes"],"mappings":"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","file":"index.map","sourceRoot":"../src","sourcesContent":["(function () {\n  if ( typeof window.CustomEvent === \"function\" ) return false; //If not IE\n\nfunction CustomEvent ( event, params ) {\n    params = params || { bubbles: false, cancelable: false, detail: undefined };\n    var evt = document.createEvent( 'CustomEvent' );\n    evt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );\n    return evt;\n    }\n\nCustomEvent.prototype = window.Event.prototype;\n\nwindow.CustomEvent = CustomEvent;\n})();\n\n//---------------------------------------\n/**\n * @name oco - one component library\n * @author David Lorenz <info@activenode.de>\n */\n\nvar _OCO_INSTALL = (function(){\n  var _forEach = function(list, loopFunc) {\n    return [].forEach.call(list, loopFunc);\n  };\n\n  /**\n   * Iterates an object and provides key,value to the looping function\n   * @param {Object} obj - the object to iterate\n   * @param {Function<Key, Value>} loopFunc\n   */\n  var _loopObject = function(obj, loopFunc) {\n    return Object.keys(obj).forEach(function(key) {\n      loopFunc(key, obj[key]);\n    });\n  };\n\n  var _map = function(list, loopFunc) {\n    return [].map.call(list, loopFunc);\n  };\n\n  var _extend = function(/** srcObj, extendObj1, extendObj2, ... */) {\n    var srcObj = arguments[0];\n    var excludeKeys = this.excludeKeys ? this.excludeKeys : false;\n\n    for (var i=1; i < arguments.length; i++) {\n      _loopObject(arguments[i], function(key, value) {\n        if (!excludeKeys || excludeKeys.indexOf(key) === -1) {\n          srcObj[key] = value;\n        }\n      });\n    }\n\n    return srcObj;\n  };\n\n  var NODE_TYPE_TEXT = 3;\n  var OCO_ATTR = 'oco';\n  var OCO_ATTR_NOT_SELECTOR = ':not(['+OCO_ATTR+'])';\n  var NODE_UPGRADED_PROTO_KEY = '__oco_upgraded_node__';\n  var DEFAULT_EVENT_NAMESPACE = '!!';\n\n  var _installer = function(_document){\n    var _componentsDefined = [];\n    var _PF_componentsLibrary = {};\n\n    function _isPolyfillRequired() {\n      return !('registerElement' in _document) && !('customElements' in window);\n    }\n\n    function _isComponentDefined(elementName) {\n      return _componentsDefined.indexOf(elementName) !== -1;\n    }\n\n    function _containsUnitializedCustomElements(domElement) {\n      if (_componentsDefined.length === 0) {\n        return false;\n      }\n      return domElement.querySelectorAll(\n        _componentsDefined.map(function(_) {\n          return _ + OCO_ATTR_NOT_SELECTOR;\n        }).join(',')\n      ).length > 0;\n    }\n\n    function _PF_setupHtmlObserver(observerCallback) {\n      var observer = new MutationObserver(function(mutations) {\n        mutations.forEach(function(mutation) {\n          var addedNodes = mutation.addedNodes;\n          var removedNodes = mutation.removedNodes;\n\n          //TODO: process removedNodes first??\n\n          _forEach(addedNodes, function(domElement) {\n            _PF_recursiveTreeUpgrade(domElement);\n          });\n        });\n      });\n\n      var config = {\n        attributes: false,\n        childList: true,\n        characterData: false,\n        subtree: true\n      };\n\n      observer.observe(_document, config);\n    }\n\n    function _PF_getUpgradeableNodes(elementName) {\n      if (!Array.isArray(elementName)) {\n        elementName = [elementName];\n      }\n\n      var componentsSelect = _document.querySelectorAll(\n        elementName.map(function(n) {\n          return n + OCO_ATTR_NOT_SELECTOR;\n        }).join(',')\n      );\n      if (componentsSelect.length === 0) {\n        return [];\n      }\n\n      return _map(componentsSelect, function(_) { return _; });\n    }\n\n    function _PF_upgradeNode(domElement) {\n      if (!domElement[NODE_UPGRADED_PROTO_KEY]) {\n        var tagName = domElement.tagName.toLowerCase();\n        var upgradePrototype = _PF_componentsLibrary[tagName];\n\n        if (upgradePrototype) {\n          Object.setPrototypeOf(domElement, upgradePrototype);\n          domElement.createdCallback();\n          // TODO: check if createdCallback was fired already! if yes: dont fire!\n          domElement.attachedCallback();\n        } else {\n          console.error('Cannot upgrade', domElement, ' the prototype definition is not available');\n        }\n      }\n    }\n\n    function _PF_recursiveTreeUpgrade(domElement) {\n      if (domElement.nodeType === NODE_TYPE_TEXT) {\n        return;\n      }\n\n      var tagName = domElement.tagName.toLowerCase();\n      if (_isComponentDefined(tagName)) {\n        // seems to be a custom component\n        _PF_upgradeNode(domElement);\n      }\n\n      if (_containsUnitializedCustomElements(domElement)) {\n        // dig deeper!\n        _forEach(domElement.childNodes, function(childDomElement) {\n          _PF_recursiveTreeUpgrade(childDomElement);\n        });\n      } // else: done\n    }\n\n    if (_isPolyfillRequired()) {\n      if (_document.readyState === 'loading') {\n        _document.addEventListener('DOMContentLoaded', function() {\n          _PF_setupHtmlObserver();\n\n          if (_componentsDefined.length > 0) {\n            _PF_getUpgradeableNodes(_componentsDefined).forEach(_PF_upgradeNode);\n          }\n        });\n      } else {\n        _PF_setupHtmlObserver();\n      }\n    }\n\n    _document.defineElement = (function(){\n      var getEventAndNamespace = function(eventName) {\n        var splittedEventString = eventName.split('.');\n        var namespaceString = splittedEventString.slice(1).join('.').trim();\n        return [splittedEventString[0], namespaceString === '' ? DEFAULT_EVENT_NAMESPACE : namespaceString];\n      };\n\n      var getElementPrototypeExtensions = function() {\n        return {\n          __eventListeners: {},\n\n          on: function(eventName, listener) {\n            var eventAndNs = getEventAndNamespace(eventName);\n            var eventKey = eventAndNs[0];\n            var eventNs = eventAndNs[1];\n            var eventListenersRef = this.__eventListeners;\n\n            if (!eventListenersRef[eventKey]) {\n              this.__eventListeners[eventKey] = new Map;\n            }\n\n            if (!eventListenersRef[eventKey].has(eventNs)) {\n              eventListenersRef[eventKey].set(eventNs, []);\n            }\n\n            eventListenersRef[eventKey].get(eventNs).push(listener);\n            this.addEventListener(eventKey, listener);\n          },\n\n          off: function(eventName, listenerToRemove) {\n            var eventAndNs = getEventAndNamespace(eventName);\n            var eventKey = eventAndNs[0];\n            var eventNs = eventAndNs[1];\n            var eventListenersRef = this.__eventListeners;\n            var _this = this;\n\n            if (!eventListenersRef[eventKey]) {\n              return;\n            }\n\n            var deleteListeners = function(evtNamespace, listenersArray) {\n              if (Array.isArray(listenersArray)) {\n                var newListenersArray = [];\n                listenersArray.forEach(function(listenerFromArray) {\n                  if (!listenerToRemove || listenerToRemove === listenerFromArray) {\n                    // remove any listener\n                    _this.removeEventListener(eventKey, listenerFromArray);\n                  } else {\n                    // add back\n                    newListenersArray.push(listenerFromArray);\n                  }\n                });\n\n                if (newListenersArray.length > 0) {\n                  // return so that its not deleted!\n                  eventListenersRef[eventKey].set(eventNs, newListenersArray);\n                  return;\n                }\n              }\n\n              eventListenersRef[eventKey].delete(evtNamespace);\n            };\n\n            if (eventNs === DEFAULT_EVENT_NAMESPACE) {\n              // delete all!\n              eventListenersRef[eventKey].forEach(deleteListeners);\n              return;\n            }\n\n            if (!eventListenersRef[eventKey].has(eventNs)) {\n              return;\n            } // else: there is a value for this namespace!\n\n            console.log('wat this', eventKey, eventListenersRef[eventKey].get(eventNs));\n            deleteListeners(eventNs, eventListenersRef[eventKey].get(eventNs));\n          }\n        };\n      };\n\n      var getHtmlElementProto = function() {\n        var prototype = Object.create(HTMLElement.prototype);\n        prototype[NODE_UPGRADED_PROTO_KEY] = true;\n\n        _forEach(arguments, function(obj) {\n          Object.keys(obj).forEach(function(key) {\n            prototype[key] = obj[key]\n          });\n        });\n\n        return prototype;\n      };\n\n      return function(elementName, methodsObj) {\n        var attachedCallback = (function(_attachedCallback) {\n          return function() {\n            this.setAttribute(OCO_ATTR, '');\n\n            if (_attachedCallback) {\n              _attachedCallback.call(this);\n            }\n          };\n        }(methodsObj.attachedCallback));\n\n        var detachedCallback = (function(_detachedCallback) {\n          return function() {\n            console.log('removing from DOM', this);\n\n            if (_detachedCallback) {\n              _detachedCallback.call(this);\n            }\n          };\n        }(methodsObj.detachedCallback));\n\n        var attachedDetachedMethods = {\n          attachedCallback: attachedCallback,\n          detachedCallback: detachedCallback\n        };\n\n        if ('customElements' in window) {\n          var classDefinition = eval('(function(){'\n          + 'return class extends HTMLElement {'\n            + 'constructor() {'\n              + 'super();'\n              + 'this[NODE_UPGRADED_PROTO_KEY] = true;'\n              + 'methodsObj.createdCallback.call(this);'\n            + '}'\n\n            + 'connectedCallback() {'\n              + 'attachedCallback.call(this);'\n            + '}'\n\n            + 'disconnectedCallback() {'\n              + 'detachedCallback.call(this);'\n            + '}'\n          + '}'\n          + '}());');\n\n          var skipMethods = Object.keys(attachedDetachedMethods);\n          _extend.call(\n            { excludeKeys: skipMethods },\n            classDefinition.prototype,\n            getElementPrototypeExtensions(),\n            methodsObj\n          );\n\n          customElements.define(elementName, classDefinition);\n        } else {\n          var elementPrototype = getHtmlElementProto(\n            getElementPrototypeExtensions(),\n            methodsObj,\n            attachedDetachedMethods\n          );\n\n          if ('registerElement' in _document) {\n            _document.registerElement(elementName, {\n              prototype: elementPrototype\n            });\n          } else {\n            _PF_componentsLibrary[elementName] = elementPrototype;\n\n            if (_document.readyState !== 'loading') {\n              var upgradeableNodes = _PF_getUpgradeableNodes(elementName);\n              upgradeableNodes.forEach(_PF_upgradeNode);\n            } // else: not needed because there is a global event listening!\n          }\n        }\n\n        _componentsDefined.push(elementName);\n      };\n    }());\n  };\n\n  return _installer;\n}());"]}